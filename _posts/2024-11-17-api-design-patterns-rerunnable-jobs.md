---
layout: post
title: API перезапускаемых задач (rerunnable jobs) 
date: 2024-11-17 00:23:30 +0000
categories: [Заметки из книг]
tags: [Паттерны проектирования API, Заметки из книг]
---

![](assets/img/memes/cron-job.jpg){: w="400" .shadow }

Это пост с кратким пересказом очередной главы книги ["API Design Patterns" Дж. Дж. Гивакса](https://www.oreilly.com/library/view/api-design-patterns/9781617295850/), посвящённой перезапускаемым задачам (rerunnable jobs).

**Зачем нужны перезапускаемые задачи?** Перезапускаемые задачи (rerunnable jobs) позволяют настроить процесс работы один раз, а затем запускать её по расписанию или по требованию, без необходимости заново передавать параметры. То есть они похожи на [длительные операции (long-running operations)](/posts/api-design-patterns-lro) с тем различием, что этот паттерн покрывает дополнительные сценарии, когда, например, требуется делегирование ролей (один человек может настраивать задачу, а другой - запускать её) или еще нужно автоматическое выполнение уже созданных операций по расписанию.

Для поддержки перезапускаемых задач нужны следующие компоненты:
1. **Ресурс Job** для хранения параметров задачи и методы для работы с ресурсом (создание, удаление, обновление). Важно, что методы эти должны быть быстрыми и синхронными.
2. **Метод Run** запускает задачу, используя параметры, сохранённые в ресурсе Job. Этот метод не требует дополнительных входных параметров и возвращает ресурс **Operation**. Далее сценарий работы аналогичен паттерну [LRO](/posts/api-design-patterns-lro).
3. И **ресурс Execution** для результатов задачи после её выполнения (например, для долгосрочного хранения отчётов или бэкапов) со своей собственной политикой хранения. Так как Execution является ресурсом, необходимо реализовать несколько стандартных методов (GET, LIST и необязательно DELETE). Результаты обычно неизменяемы, стандартный метод UPDATE реализовывать не нужно. Метод CREATE тоже не нужен, поскольку ресурс создается не конечным пользователем, а внутренними процессами.

И напоследок, примеры использования паттерна rerunnable jobs:
- Задачи резервного копирования могут быть настроены как перезапускаемые. Пользователь задаёт расписание для регулярных бэкапов, далее задача запускается по этому расписанию и после завершения создаётся новый ресурс, который представляет собой бэкап. Процесс может включать создание дополнительных данных, например, архивов на S3.
- В системах отчетности, например, для финансовых или аналитических приложений, могут быть настроены задачи для автоматической генерации отчётов. Эти задачи могут запускаться еженедельно или ежемесячно, а результатом выполнения соответственно будут отчеты.
